<div class="container-fluid py-4">
  <div class="row mb-4">
    <div class="col-12">
      <div class="card shadow-sm">
        <div class="card-body d-flex justify-content-between align-items-center">
          <h1 class="h3 mb-0">Student Dashboard</h1>
          <div class="d-flex align-items-center">
            <span class="me-3">Welcome</span>
            <div class="dropdown">
              <button class="btn btn-light dropdown-toggle d-flex align-items-center" type="button" id="profileDropdown"
              data-bs-toggle="dropdown" aria-expanded="false">
                <img [src]="profilePictureUrl" alt="Admin" class="rounded-circle me-2" width="32" height="32" />
                <span>{{userName}}</span>
              </button>
              <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="profileDropdown">
                <li><a class="dropdown-item" routerLink="/student/student-profile"><i class="bi bi-gear me-2"></i>Student Profile</a></li>
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item" href="#" (click)="logout()"><i class="bi bi-box-arrow-right me-2"></i>Logout</a></li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

<br>
<br>
  <div class="row mb-4">
    <div class="col-md-3 mb-4 mb-md-0">
      <div class="card bg-primary text-white shadow-sm h-100">
        <div class="card-body">
          <div class="d-flex align-items-center">
            <div class="rounded-circle bg-white bg-opacity-25 p-3 me-3">
              <i class="bi bi-book fs-4"></i>
            </div>
            <div>
              <h3 class="h2 mb-0">{{paidCourses}}</h3>
              <p class="mb-0">Paid Courses</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-3 mb-4 mb-md-0">
      <div class="card bg-warning text-white shadow-sm h-100">
        <div class="card-body">
          <div class="d-flex align-items-center">
            <div class="rounded-circle bg-white bg-opacity-25 p-3 me-3">
              <i class="bi bi-list-task fs-4"></i>
            </div>
            <div>
              <h3 class="h2 mb-0">{{freeCourses}}</h3>
              <p class="mb-0">Free Courses</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-3 mb-4 mb-md-0">
      <div class="card bg-success text-white shadow-sm h-100">
        <div class="card-body">
          <div class="d-flex align-items-center">
            <div class="rounded-circle bg-white bg-opacity-25 p-3 me-3">
              <i class="bi bi-award fs-4"></i>
            </div>
            <div>
              <h3 class="h2 mb-0">{{appliedJobs}}</h3>
              <p class="mb-0">Applied Jobs</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card bg-info text-white shadow-sm h-100">
        <div class="card-body">
          <div class="d-flex align-items-center">
            <div class="rounded-circle bg-white bg-opacity-25 p-3 me-3">
              <i class="bi bi-calendar-event fs-4"></i>
            </div>
            <div>
              <h3 class="h2 mb-0">{{appliedInternships}}</h3>
              <p class="mb-0">Applied Internships</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-lg-8 mb-4 mb-lg-0">
    
      <div class="card shadow-sm mb-4" *ngIf="mycourses.length > 0">
        <div class="card-header bg-white d-flex justify-content-between align-items-center py-3">
          <h5 class="mb-0">My Courses</h5>
          <button class="btn btn-sm btn-primary" routerLink="/student/allcourses">View All</button>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6 mb-4" *ngFor="let course of mycourses">
              <div class="card h-100 border-0 shadow-sm">
                <div class="position-relative">
                  <img [src]="course.courseImages[0]?.url || 'assets/images/default-course.jpg'"
                    class="card-img-top"
                    [alt]="course.courseName"
                    style="height: 140px; object-fit: cover;">
                  <span class="position-absolute top-0 end-0 badge bg-primary m-2">In Progress</span>
                </div>
                <div class="card-body">
                  <h5 class="card-title">{{ course.courseName }}</h5>
                  <div class="d-flex justify-content-between mb-2 text-muted small">
                    <span><i class="bi bi-clock me-1"></i> {{ course.startDate | date:'MMM d' }} - {{ course.endDate | date:'MMM d' }}</span>
                    <span><i class="bi bi-person me-1"></i> {{ course.faculty.userFirstName }} {{ course.faculty.userLastName }}</span>
                  </div>
                  <div class="progress mb-2" style="height: 6px;">
                    <div class="progress-bar bg-primary" role="progressbar"
                      [style.width.%]="course.progress[0]?.progressPercentage || 0"
                      [attr.aria-valuenow]="course.progress[0]?.progressPercentage || 0"
                      aria-valuemin="0" aria-valuemax="100">
                    </div>
                  </div>
                  <p class="small text-muted mb-3">{{ course.progress[0]?.progressPercentage || 0 }}% Complete</p>
                  <button class="btn btn-outline-primary w-100"
                    [routerLink]="['/learning', course.id]">
                  Continue Learning
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      
      <div class="card shadow-sm border-0 rounded-3">
  <div class="card-header bg-white border-0 d-flex justify-content-between align-items-center py-3">
    <div>
      <h5 class="mb-0 fw-bold text-dark">
        <i class="bi bi-clock-history text-info me-2"></i>Recent Applications
      </h5>
      <small class="text-muted">Your latest job/internship applications</small>
    </div>
    <button class="btn btn-outline-primary btn-sm" (click)="viewAllApplications()">
      View All Applications
      <span class="badge bg-primary ms-2" *ngIf="applications && applications.length > 5">
        {{ applications.length - 5 }}+
      </span>
    </button>
  </div>

  <div class="card-body p-0">
    <div class="list-group list-group-flush" *ngIf="applications && applications.length > 0">
      <div class="list-group-item border-0 p-3" *ngFor="let app of getRecentApplications()">
        <div class="d-flex align-items-center">
          <div class="position-relative me-3">
            <img [src]="app.studentProfilePicture?.profilePictureUrl"
              class="rounded-circle border shadow-sm" width="50" height="50" alt="Candidate" />
          </div>
          <div class="flex-grow-1">
            <div class="d-flex justify-content-between align-items-center mb-1">
              <div>
                <h6 class="mb-0 fw-medium">
                  {{ app.job?.title || app.internship?.title }}
                </h6>
                <small class="text-muted">
                  <i class="bi bi-building me-1"></i>
                  {{ app.job?.companyName || app.internship?.companyName }}
                </small>
              </div>
              <span class="badge" [ngClass]="{
                'bg-primary-subtle text-primary': app.job,
                'bg-success-subtle text-success': app.internship
              }">
                <i class="bi" [ngClass]="{
                  'bi-briefcase': app.job,
                  'bi-mortarboard': app.internship
                }" class="me-1"></i>
                {{ app.job ? 'Job' : 'Internship' }}
              </span>
            </div>
            <p class="text-muted small mb-1">
              <i class="bi bi-calendar me-1"></i>
              Applied {{ getRelativeDate(app.appliedDate) }}
            </p>
            <span class="badge rounded-pill" [ngClass]="{
              'bg-warning text-dark': app.status === 'APPLICATIONS_RECEIVED',
              'bg-info text-white': app.status === 'RESUME_SCREENING',
              'bg-primary': app.status === 'SHORTLISTED',
              'bg-secondary': app.status === 'TECHNICAL_ASSESSMENT' || app.status === 'FINAL_INTERVIEW',
              'bg-success': app.status === 'OFFER_EXTENDED',
              'bg-danger': app.status === 'REJECTED'
            }">
              {{ formatStatus(app.status) }}
            </span>
          </div>
        </div>
      </div>
    </div>

    <div class="p-3 text-muted text-center" *ngIf="applications && applications.length === 0">
      You havenâ€™t applied to any jobs or internships yet.
    </div>

    <div class="p-3 text-muted text-center" *ngIf="!applications">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>
  </div>
</div>

    </div>

    <div class="col-lg-4">
     
      <div class="card shadow-sm border-0 rounded-3 mb-4">
    <div class="card-header bg-white border-0 d-flex justify-content-between align-items-center py-3">
      <div>
        <h5 class="mb-0 fw-bold text-dark">
          <i class="bi bi-calendar3 text-primary me-2"></i>Event Calendar
        </h5>
        <small class="text-muted">Create Events to memorize</small>
      </div>
    </div>
    <div class="card-body">
      <div class="calendar-container">
        <div class="header d-flex justify-content-between align-items-center mb-3">
          <button class="btn btn-sm btn-outline-primary" (click)="prevMonth()">&lt;</button>
          <h2 class="h5 mb-0">{{ currentMonth | date:'MMMM yyyy' }}</h2>
          <button class="btn btn-sm btn-outline-primary" (click)="nextMonth()">&gt;</button>
        </div>

        <div class="weekdays d-flex text-center mb-2">
          <div *ngFor="let day of ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat']" class="flex-fill fw-semibold">
            {{ day }}
          </div>
        </div>

        <div class="weeks">
          <div *ngFor="let week of weeks" class="d-flex mb-1">
            <div *ngFor="let day of week" class="flex-fill border rounded p-2 text-center"
                 [class.bg-light]="!day" [class.bg-warning]="isToday(day)"
                 [class.text-dark]="isToday(day)" (click)="day && onDateClick(day)">
              <div class="date-number">{{ day?.getDate() }}</div>
              <div class="dots mt-1">
                <span *ngFor="let ev of getEventsForDate(day)" class="dot bg-primary rounded-circle d-inline-block"
                      style="width:6px; height:6px;" title="{{ ev.title }}"></span>
              </div>
            </div>
          </div>
        </div>
      </div>
      <hr>
      <div class="mb-2">
      <h6 class="fw-semibold text-primary mb-2">ðŸ“… Upcoming Events</h6>
      <ul class="list-group list-group-flush">
        <li *ngFor="let event of upcomingEvents" class="list-group-item px-0 d-flex justify-content-between align-items-start">
          <div>
            <strong>{{ event.title }}</strong><br />
            <small class="text-muted">{{ event.dateTime | date: 'fullDate' }} â€¢ {{ event.dateTime | date: 'shortTime' }}</small>
          </div>
          <span class="badge bg-light text-dark">{{ event.description }}</span>
        </li>
        <li *ngIf="upcomingEvents.length === 0" class="list-group-item px-0 text-muted">
          No upcoming events
        </li>
      </ul>
    </div>
    </div>
  </div>

  <!-- Modal for events -->
  <div class="modal-backdrop fade show" *ngIf="showEventModal"></div>
  <div class="modal d-block" tabindex="-1" *ngIf="showEventModal">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header d-flex justify-content-between align-items-center">
          <h5 class="modal-title">Events on {{ selectedDate | date:'fullDate' }}</h5>
          <div class="d-flex align-items-center gap-2">
            <button mat-raised-button color="primary" (click)="toggleReminders()">
              {{ remindersEnabled ? 'Disable Reminders' : 'Enable Reminders' }}
            </button>
            <button type="button" class="btn-close" aria-label="Close" (click)="closeModal()"></button>
          </div>
        </div>
        <div class="modal-body">
          <ul class="list-unstyled mb-3">
            <li *ngFor="let event of selectedDateEvents" class="mb-2 border-bottom pb-2">
              <strong>{{ event.title }}</strong><br />
              <small>{{ event.description }}</small><br />
              <small>{{ event.dateTime | date:'shortTime' }}</small><br />
              <button class="btn btn-sm btn-warning me-2" (click)="onEditEvent(event)">Edit</button>
              <button class="btn btn-sm btn-danger" (click)="onDeleteEvent(event)">Delete</button>
            </li>
          </ul>

          <form [formGroup]="eventForm" (ngSubmit)="onSaveEvent()">
            <input formControlName="title" class="form-control mb-2" placeholder="Title" required />
            <input formControlName="description" class="form-control mb-2" placeholder="Description" />
            <input formControlName="dateTime" type="datetime-local" class="form-control mb-3" required />
            <div class="d-flex justify-content-between">
              <button type="submit" class="btn btn-primary">{{ editingEvent ? 'Update' : 'Add' }}</button>
              <button type="button" class="btn btn-secondary" (click)="closeModal()">Close</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
 
    </div>
  </div>
</div>